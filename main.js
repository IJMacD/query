!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var a=document.getElementById("input"),r=document.getElementById("output"),o=document.getElementById("query-form"),i=document.getElementById("query-suggest"),c=document.getElementById("explorer"),l=document.getElementById("explorer-toggle"),u=document.getElementById("expanded-input-toggle"),s=document.getElementById("input-expanded"),d=function(){var e=localStorage.getItem("query_history");if(e)try{return JSON.parse(e)}catch(e){}return[]}(),p=!1;m(),a.focus(),function e(){var t=document.getElementById("explorer");t.innerHTML="",t.className="";var n=document.createElement("button");n.innerText="Refresh",n.addEventListener("click",e),t.appendChild(n);var r=document.createElement("label"),o=document.createElement("input");o.checked=!0,o.type="radio",o.name="browse_or_insert",r.appendChild(o),r.appendChild(document.createTextNode("Browse"));var i=document.createElement("label"),c=document.createElement("input");c.type="radio",c.name="browse_or_insert",i.appendChild(c),i.appendChild(document.createTextNode("Insert")),t.onclick=function(e){var t=e.target;if(t instanceof HTMLSpanElement&&(t=t.parentElement),t instanceof HTMLLIElement){var n=a.value,r=a.selectionStart,i=a.selectionEnd,c=t,l=c.dataset,u=c.classList,s=l.insert,d=l.insertBefore,p=void 0===d?"":d,f=l.insertAfter,m=void 0===f?"":f;if(u.contains("treeview"))return void u.toggle("collapsed");if(o.checked&&s)return a.value="FROM ".concat(s),void h();var g=n.substring(0,r),v=n.substring(r,i),y=n.substring(i),E=s||v;a.value=g+p+E+m+y,r+=p.length,i=""===v?r+=E.length:r+E.length,a.setSelectionRange(r,i),a.focus()}};var l=document.createElement("h2");l.innerText="Tables",t.appendChild(l),t.appendChild(r),t.appendChild(i);var u=document.createElement("ul");t.appendChild(u),query("FROM information_schema.tables\n        SELECT table_schema, table_name, table_type\n        UNION ALL\n        FROM information_schema.routines\n        WHERE data_type = 'table'\n        SELECT routine_schema, routine_name, 'table function'").then((function(e){e.shift();var t=null,n=e.map((function(e){var n="",a=e[0]||"No Schema";if(a!==t&&(null!==t&&(n+="</ul></li>"),n+='<li class="schema treeview collapsed"><span>'.concat(a,"</span><ul>")),"table function"===e[2]){var r="".concat(e[1],"(");n+='<li class="'.concat("table-function",'" data-insert-before="').concat(r,'" data-insert-after="').concat(")",'" title="TABLE VALUED FUNCTION">').concat(e[1],"</li>")}else{var o=e[2].includes("VIEW")?"view":"table",i="".concat(e[0]?e[0]+".":"").concat(e[1]);n+='<li class="'.concat(o,'" data-insert="').concat(i,'" title="').concat(e[2],'">').concat(e[1],"</li>")}return t=a,n})).join("");u.innerHTML=n}));var s=document.createElement("h2");s.innerText="Functions",t.appendChild(s);var d=document.createElement("ul");t.appendChild(d),query("FROM information_schema.routines WHERE data_type != 'table'").then((function(e){var t=e.shift(),n=t.indexOf("routine_name"),a=t.indexOf("routine_type"),r=e.map((function(e){var t="AGGREGATE FUNCTION"===e[a]||"WINDOW FUNCTION"===e[a]?"aggregate-function":"function";return'<li class="'.concat(t,'" data-insert-before="').concat(e[n],'(" data-insert-after=")" title="').concat(e[a],'">').concat(e[n],"</li>")})).join("");d.innerHTML=r}));var p=document.createElement("h2");p.innerText="Keywords",t.appendChild(p);var f=document.createElement("ul");t.appendChild(f);var m=["SELECT","FROM","WHERE","GROUP BY","ORDER BY","OVER","WITH"].map((function(e){return'<li class="" data-insert-before="'.concat(e,' ">').concat(e,"</li>")})).join("");f.innerHTML=m}(),o.addEventListener("submit",(function(e){e.preventDefault(),h()})),document.addEventListener("keydown",(function(e){if(e.target instanceof HTMLTextAreaElement){if("Tab"===e.key){e.preventDefault();var t=e.target.selectionStart,n=e.target.selectionEnd,r=e.target.value,o=r.substring(t,n);e.target.value=r.substring(0,t)+"\t"+o.replace(/\n/g,"\n\t")+r.substring(n),e.target.selectionStart=e.target.selectionEnd=t+1}}else if("Enter"===e.key)h();else if("Escape"===e.key)y();else if("Tab"===e.key){var i=g();i.length>=1&&(e.preventDefault(),a.value=i[0])}})),a.addEventListener("keyup",(function(e){if(e.altKey&&"1234567890".includes(e.key)){e.preventDefault();var t=g()["1234567890".indexOf(e.key)];void 0!==t&&(a.value=t)}else if("Escape"===e.key)return;v()})),i.addEventListener("click",(function(e){e.target instanceof HTMLLIElement&&(a.value=e.target.textContent,v(),a.focus())})),window.addEventListener("hashchange",m),c.style.display="none";var f=function(e){c.style.display="none"===c.style.display?"block":"none",e.stopPropagation()};function m(){if(location.hash&&!a.disabled){var e=new URLSearchParams(location.hash.substr(1));e.has("q")&&(a.value=e.get("q"),h())}}function h(){y(),p||(s.value=a.value);var e=s.value;r.innerHTML="",a.disabled=!0,s.disabled=!0;var t=Date.now();location.hash="#q="+encodeURIComponent(e),document.title="Query: "+e,query(e).then((function(o){var i,c=(Date.now()-t)/1e3;if(function(e){(d=d.filter((function(t){return t!==e}))).unshift(a.value),d.length=100,localStorage.setItem("query_history",JSON.stringify(d))}(e),2!==o.length||"AST"!==o[0][0]){if(r.innerHTML=function(e){var t=e.rows,n=e.duration,a=t.shift();if(!a)return'<p style="font-weight: bold;">Empty Result Set</p><p>'.concat(n," seconds</p>");return"<table>\n            <thead>\n                <tr>".concat(a.map((function(e){return"<th>".concat(e,"</th>")})).join(""),"</tr>\n            </thead>\n            <tbody>\n                ").concat(t.map((function(e){return"\n                    <tr>".concat(e.map((function(e){return"<td>".concat(function(e){var t=e.cell;if(null===t)return'<span class="null"></span>';if(t instanceof Date)return function(e){if(0===e.getHours()&&0===e.getMinutes())return e.toLocaleDateString(navigator.language);return e.toLocaleString(navigator.language)}(t);var n=String(t);n.includes("<")&&(a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},n=n.replace(/[&<>"']/g,(function(e){return a[e]})));var a;if(/^#[0-9a-f]{6}$/i.test(n))return'<div style="background-color: '.concat(n,'; height: 20px; width: 20px; margin: 0 auto;" title="').concat(n,'"></div>');n.includes("<")||(n=(n=n.replace(/https?:\/\/[^,'>" &()[\]]+/g,(function(e){var t=e;return/\.(jpe?g|gif|png|webp)$/i.test(e)&&(t='<img src="'.concat(e,'" height="64" />')),'<a href="'.concat(e,'" target="_blank">').concat(t,"</a>")}))).replace(/[^@,\s]+@[^@,\s]+\.[^@,\s]+/g,(function(e){return'<a href="mailto:'.concat(e,'">').concat(e,"</a>")})));return n}({cell:e}),"</td>")})).join(""),"</tr>\n                ")})).join(""),'\n            </tbody>\n            <tfoot><tr><td colspan="').concat(a.length,'">').concat(t.length," rows, ").concat(n," seconds</td></tr></tfoot>\n        </table>")}({rows:o.slice(),duration:c}),o.length>=3&&o[0].length>=2&&"number"==typeof o[1][0]&&"number"==typeof o[1][1]){var l=document.createElement("button");l.innerHTML="Graph "+o[0][1]+" vs. "+o[0][0],l.addEventListener("click",(function(){r.removeChild(l),r.appendChild(function(e){var t=document.createElement("canvas"),a=t.getContext("2d");t.width=300,t.height=300;e.shift();var r=e.map((function(e){return e[0]})),o=e.map((function(e){return e[1]})),i=Math.min.apply(Math,n(r)),c=Math.max.apply(Math,n(r)),l=Math.min.apply(Math,n(o)),u=Math.max.apply(Math,n(o)),s=t.width/(c-i),d=t.height/(u-l),p=t.height;a.strokeStyle="#999",a.strokeRect(0,0,t.width,t.height),a.beginPath(),a.moveTo((r[0]-i)*s,p-(o[0]-l)*d);for(var f=1;f<e.length;f++)a.lineTo((r[f]-i)*s,p-(o[f]-l)*d);return a.strokeStyle="red",a.stroke(),t}(o.slice()))})),r.appendChild(l)}}else r.innerHTML=(i=o[1][0],function e(t){var n={UNKNOWN:0,STATEMENT:1,CLAUSE:2,FUNCTION_CALL:3,SYMBOL:4,STRING:5,NUMBER:6,OPERATOR:7,LIST:8,COMPOUND_QUERY:9},a=Object.keys(n)[t.type].toLowerCase().replace(/[ _]/g,"-"),r=String(null!==t.id?t.id:t.type===n.LIST?"LIST":""),o=r.toLowerCase().replace(/[ _]/g,"-"),i=(t.source||"").replace(/ +AS +"?[a-zA-Z0-9_.]+"? *$/,"");return'<div class="node-type-'.concat(a," node-id-").concat(o,'" title="').concat(i.replace(/"/g,"&quot;"),'">\n        ').concat(r?'<span class="node-id">'.concat(r,"</span>"):"","\n        ").concat(Array.isArray(t.children)?"<ul>".concat(t.children.map((function(t){var n=t.source||"",a=n.match(/ +AS +"?[a-zA-Z0-9_.]+"? *$/);return'<li title="'.concat(n.replace(/"/g,"&quot;"),'">\n                ').concat(t.alias?'<span class="node-alias" title="'.concat(a?a[0].replace(/"/g,"&quot;"):"",'">').concat(t.alias,"</span>"):"","\n                ").concat(e(t),"\n            </li>")})).join(""),"</ul>"):"","\n    </div>")}(JSON.parse(i)))})).catch((function(e){r.innerHTML='<p style="color: red; margin: 20px; font-family: monospace;">'.concat(e,"</p>")})).then((function(){a.disabled=!1,s.disabled=!1}))}function g(){return d.filter((function(e){return e&&e!=a.value&&e.startsWith(a.value)})).slice(0,20)}function v(){i.innerHTML=g().map((function(e){return"<li>".concat(e,"</li>")})).join("")}function y(){i.innerHTML=""}l.addEventListener("click",f),l.addEventListener("touchstart",f),u.addEventListener("click",(function(e){p=!p,a.style.display=p?"none":"",s.style.display=p?"":"none",p?s.value=a.value:a.value=s.value}))}]);