!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var r=document.getElementById("input"),o=document.getElementById("params"),i=document.getElementById("output"),c=document.getElementById("query-form"),l=document.getElementById("query-suggest"),u=document.getElementById("explorer"),s=document.getElementById("explorer-toggle"),d=document.getElementById("expanded-input-toggle"),p=document.getElementById("input-expanded"),f=function(){var e=localStorage.getItem("query_history");if(e)try{return JSON.parse(e)}catch(e){}return[]}(),m=n(1).NODE_TYPES,h=!1,v={};y(),r.focus(),function e(){var t=document.getElementById("explorer");t.innerHTML="",t.className="";var n=document.createElement("button");n.innerText="Refresh",n.addEventListener("click",e),t.appendChild(n);var a=document.createElement("label"),o=document.createElement("input");o.checked=!0,o.type="radio",o.name="browse_or_insert",a.appendChild(o),a.appendChild(document.createTextNode("Browse"));var i=document.createElement("label"),c=document.createElement("input");c.type="radio",c.name="browse_or_insert",i.appendChild(c),i.appendChild(document.createTextNode("Insert")),t.onclick=function(e){var t=e.target;if(t instanceof HTMLSpanElement&&(t=t.parentElement),t instanceof HTMLLIElement){var n=r.value,a=r.selectionStart,i=r.selectionEnd,c=t,l=c.dataset,u=c.classList,s=l.insert,d=l.insertBefore,p=void 0===d?"":d,f=l.insertAfter,m=void 0===f?"":f;if(u.contains("treeview"))return void u.toggle("collapsed");if(o.checked&&s)return r.value="FROM ".concat(s),void E();var h=n.substring(0,a),v=n.substring(a,i),g=n.substring(i),y=s||v;r.value=h+p+y+m+g,a+=p.length,i=""===v?a+=y.length:a+y.length,r.setSelectionRange(a,i),r.focus()}};var l=document.createElement("h2");l.innerText="Tables",t.appendChild(l),t.appendChild(a),t.appendChild(i);var u=document.createElement("ul");t.appendChild(u),query("FROM information_schema.tables\n        SELECT table_schema, table_name, table_type\n        UNION ALL\n        FROM information_schema.routines\n        WHERE data_type = 'table'\n        SELECT routine_schema, routine_name, 'table function'").then((function(e){e.shift();var t=null,n=e.map((function(e){var n="",a=e[0]||"No Schema";if(a!==t&&(null!==t&&(n+="</ul></li>"),n+='<li class="schema treeview collapsed"><span>'.concat(a,"</span><ul>")),"table function"===e[2]){var r="".concat(e[1],"(");n+='<li class="'.concat("table-function",'" data-insert-before="').concat(r,'" data-insert-after="').concat(")",'" title="TABLE VALUED FUNCTION">').concat(e[1],"</li>")}else{var o=e[2].includes("VIEW")?"view":"table",i="".concat(e[0]?e[0]+".":"").concat(e[1]);n+='<li class="'.concat(o,'" data-insert="').concat(i,'" title="').concat(e[2],'">').concat(e[1],"</li>")}return t=a,n})).join("");u.innerHTML=n}));var s=document.createElement("h2");s.innerText="Functions",t.appendChild(s);var d=document.createElement("ul");t.appendChild(d),query("FROM information_schema.routines WHERE data_type != 'table'").then((function(e){var t=e.shift(),n=t.indexOf("routine_name"),a=t.indexOf("routine_type"),r=e.map((function(e){var t="AGGREGATE FUNCTION"===e[a]||"WINDOW FUNCTION"===e[a]?"aggregate-function":"function";return'<li class="'.concat(t,'" data-insert-before="').concat(e[n],'(" data-insert-after=")" title="').concat(e[a],'">').concat(e[n],"</li>")})).join("");d.innerHTML=r}));var p=document.createElement("h2");p.innerText="Keywords",t.appendChild(p);var f=document.createElement("ul");t.appendChild(f);var m=["SELECT","FROM","WHERE","GROUP BY","ORDER BY","OVER","WITH"].map((function(e){return'<li class="" data-insert-before="'.concat(e,' ">').concat(e,"</li>")})).join("");f.innerHTML=m}(),c.addEventListener("submit",(function(e){e.preventDefault(),E()})),document.addEventListener("keydown",(function(e){if(e.target instanceof HTMLTextAreaElement){if("Tab"===e.key){e.preventDefault();var t=e.target.selectionStart,n=e.target.selectionEnd,a=e.target.value,o=a.substring(t,n);e.target.value=a.substring(0,t)+"\t"+o.replace(/\n/g,"\n\t")+a.substring(n),e.target.selectionStart=e.target.selectionEnd=t+1}}else if("Enter"===e.key)E();else if("Escape"===e.key)L();else if("Tab"===e.key){var i=b();i.length>=1&&(e.preventDefault(),r.value=i[0])}})),r.addEventListener("keyup",(function(e){if(e.altKey&&"1234567890".includes(e.key)){e.preventDefault();var t=b()["1234567890".indexOf(e.key)];void 0!==t&&(r.value=t)}else if("Escape"===e.key)return;T()})),l.addEventListener("click",(function(e){e.target instanceof HTMLLIElement&&(r.value=e.target.textContent,T(),r.focus())})),window.addEventListener("hashchange",y),u.style.display="none";var g=function(e){u.style.display="none"===u.style.display?"block":"none",e.stopPropagation()};function y(){if(location.hash&&!r.disabled){var e=new URLSearchParams(location.hash.substr(1));e.has("q")&&(r.value=e.get("q"),E())}}function E(){L(),h||(p.value=r.value);var e=p.value;i.innerHTML="",r.disabled=!0,p.disabled=!0;var t,n=Date.now();if(location.hash="#q="+encodeURIComponent(e),document.title="Query: "+e,query.prepare){o.innerHTML="";try{var c=query.prepare(e),l=!0,u=!1,s=void 0;try{for(var d,g=function(){var e=d.value;void 0===v[e]&&(v[e]="");var t=document.createElement("input");t.value=v[e],t.title=e,t.placeholder=e,t.onchange=function(){return v[e]=isNaN(+t.value)?t.value:+t.value},o.appendChild(t)},y=c.namedParams[Symbol.iterator]();!(l=(d=y.next()).done);l=!0)g()}catch(e){u=!0,s=e}finally{try{l||null==y.return||y.return()}finally{if(u)throw s}}t=c.execute(v)}catch(n){t=query(e)}}else t=query(e);t.then((function(t){var o,c=(Date.now()-n)/1e3;if(function(e){(f=f.filter((function(t){return t!==e}))).unshift(r.value),f.length=100,localStorage.setItem("query_history",JSON.stringify(f))}(e),console.log(t),2!==t.length||"AST"!==t[0][0]){if(i.innerHTML=function(e){var t=e.rows,n=e.duration,a=t.shift();if(!a)return'<p style="font-weight: bold;">Empty Result Set</p><p>'.concat(n," seconds</p>");return"<table>\n            <thead>\n                <tr>".concat(a.map((function(e){return"<th>".concat(e,"</th>")})).join(""),"</tr>\n            </thead>\n            <tbody>\n                ").concat(t.map((function(e){return"\n                    <tr>".concat(e.map((function(e){return"<td>".concat(function(e){var t=e.cell;if(null===t)return'<span class="null"></span>';if(t instanceof Date)return function(e){if(0===e.getHours()&&0===e.getMinutes())return e.toLocaleDateString(navigator.language);return e.toLocaleString(navigator.language)}(t);var n=String(t);n.includes("<")&&(a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},n=n.replace(/[&<>"']/g,(function(e){return a[e]})));var a;if(/^#[0-9a-f]{6}$/i.test(n))return'<div style="background-color: '.concat(n,'; height: 20px; width: 20px; margin: 0 auto;" title="').concat(n,'"></div>');n.includes("<")||(n=(n=n.replace(/https?:\/\/[^,'>" &()[\]]+/g,(function(e){var t=e;return/\.(jpe?g|gif|png|webp)$/i.test(e)&&(t='<img src="'.concat(e,'" height="64" />')),'<a href="'.concat(e,'" target="_blank">').concat(t,"</a>")}))).replace(/[^@,\s]+@[^@,\s]+\.[^@,\s]+/g,(function(e){return'<a href="mailto:'.concat(e,'">').concat(e,"</a>")})));return n}({cell:e}),"</td>")})).join(""),"</tr>\n                ")})).join(""),'\n            </tbody>\n            <tfoot><tr><td colspan="').concat(a.length,'">').concat(t.length," rows, ").concat(n," seconds</td></tr></tfoot>\n        </table>")}({rows:t.slice(),duration:c}),t.length>=3&&t[0].length>=2&&"number"==typeof t[1][0]&&"number"==typeof t[1][1]){var l=document.createElement("button");l.innerHTML="Graph "+t[0][1]+" vs. "+t[0][0],l.addEventListener("click",(function(){i.removeChild(l),i.appendChild(function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=300,t.height=300;e.shift();var r=e.map((function(e){return e[0]})),o=e.map((function(e){return e[1]})),i=Math.min.apply(Math,a(r)),c=Math.max.apply(Math,a(r)),l=Math.min.apply(Math,a(o)),u=Math.max.apply(Math,a(o)),s=t.width/(c-i),d=t.height/(u-l),p=t.height;n.strokeStyle="#999",n.strokeRect(0,0,t.width,t.height),n.beginPath(),n.moveTo((r[0]-i)*s,p-(o[0]-l)*d);for(var f=1;f<e.length;f++)n.lineTo((r[f]-i)*s,p-(o[f]-l)*d);return n.strokeStyle="red",n.stroke(),t}(t.slice()))})),i.appendChild(l)}}else i.innerHTML=(o=t[1][0],function e(t){var n=Object.keys(m)[t.type].toLowerCase().replace(/[ _]/g,"-"),a=String(null!==t.id?t.id:t.type===m.LIST?"LIST":""),r=a.toLowerCase().replace(/[ _]/g,"-"),o=(t.source||"").replace(/ +AS +"?[a-zA-Z0-9_.]+"? *$/,"");return'<div class="node-type-'.concat(n," node-id-").concat(r,'" title="').concat(o.replace(/"/g,"&quot;"),'">\n        ').concat(a?'<span class="node-id">'.concat(a,"</span>"):"","\n        ").concat(Array.isArray(t.children)?"<ul>".concat(t.children.map((function(t){var n=t.source||"",a=n.match(/ +AS +"?[a-zA-Z0-9_.]+"? *$/);return'<li title="'.concat(n.replace(/"/g,"&quot;"),'">\n                ').concat(t.alias?'<span class="node-alias" title="'.concat(a?a[0].replace(/"/g,"&quot;"):"",'">').concat(t.alias,"</span>"):"","\n                ").concat(e(t),"\n            </li>")})).join(""),"</ul>"):"","\n    </div>")}(JSON.parse(o)))})).catch((function(e){i.innerHTML='<p style="color: red; margin: 20px; font-family: monospace;">'.concat(e,"</p>")})).then((function(){r.disabled=!1,p.disabled=!1}))}function b(){return f.filter((function(e){return e&&e!=r.value&&e.startsWith(r.value)})).slice(0,20)}function T(){l.innerHTML=b().map((function(e){return"<li>".concat(e,"</li>")})).join("")}function L(){l.innerHTML=""}s.addEventListener("click",g),s.addEventListener("touchstart",g),d.addEventListener("click",(function(e){h=!h,r.style.display=h?"none":"",p.style.display=h?"":"none",h?p.value=r.value:r.value=p.value}))},function(e,t){e.exports={NODE_TYPES:{UNKNOWN:0,STATEMENT:1,CLAUSE:2,FUNCTION_CALL:3,SYMBOL:4,STRING:5,NUMBER:6,OPERATOR:7,LIST:8,COMPOUND_QUERY:9,CONSTANT:10,PARAM:11},TOKEN_TYPES:{UNKNOWN:0,BRACKET:1,COMMA:2,KEYWORD:3,NAME:4,STRING:5,NUMBER:6,OPERATOR:7,QUERY_OPERATOR:8,CONSTANT:9,PARAM:10}}}]);